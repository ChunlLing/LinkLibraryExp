# 动态链接库编程实验

## 概述
    在Windows操作系统环境中，编写程序离不开系统提供的库函数，有些常规运算和系统调用等函数都是通过库函数方式提供的。Windows库函数都是可执行代码，其库类型主要有静态链接库（Static Link Library, Lib）和动态链接库（Dynamic Link Library, DLL）两种。在开发软件产品时，对于通用功能的函数，一般以DLL的形式来实现，如Windows的设备驱动程序就是一个动态链接库。
	
### 动态链接库的概念
    动态链接库与静态链接库类似，它其实是一种用来为其他可执行文件（包括EXE文件和其他DLL）提供共享的函数库。DLL中一般定义有两种类型的函数：导出函数（Export Function）和内部函数（Internal Function）。导出函数是可以被外部程序调用的函数，内部函数只能在DLL内部使用。尽管DLL类型各异，但每个DLL都含有一个入口点函数DLLMain()，就像我们编写的应用程序必须有main()或WinMain()函数一样。DLLMain()的作用是初始化DLL，并在卸载时清理DLL。

### 动态链接库和静态链接库的区别
    动态链接是相对于静态链接来说的。在程序开发过程中，产生一个Windows可执行文件，需要链接不同的目标快（.obj）、库文件（.lib）以及编译过的资源文件（.res），此时的链接称为静态链接，可见静态链接发生在程序进行编译/链接时，与之对应，动态链接发生在程序运行时。
	动态链接库和静态链接库的主要区别是与应用程序的链接方式不同，前者进行的是动态链接，后者进行的是静态链接。编写的应用程序中需要使用DLL的应用程序，可以调用DLL中的导出函数，不过在应用程序本身的执行代码中并不包含这些函数的执行代码，它们经过编译和链接之后，独立的保存在DLL中。使用DLL的应用程序只包含了用于从DLL中定位所引用的函数的信息，而没有函数具体实现，要等到程序运行时才从DLL中获取得函数的实现代码。显然，我们开发的使用了DLL的应用程序在运行时必须要有相应的DLL支持。而使用静态链接库的应用程序从函数库中得到所引用的函数的执行代码，然后把执行代码放进程序自身的执行文件中，这样，应用程序在运行时就可以不再需要静态函数库的支持了。

### 使用动态链接库的优点
    Windows大量使用动态链接库，使用DLL与传统的静态链接库相比具有更多的优势：
	* 动态链接库实现了多个应用程序共享数据和代码的方式。
	* 由于上述原因，多个应用程序还可以同时共享动态链接库在内存中的同一份副本，这样就有效的节省了应用程序所占用的内存资源，减少了频繁的内存交换，从而提高了应用程序的执行效率和运行速度。
	* 由于动态链接库是独立于可执行文件的，因此，如果需要向动态链接库中增加新的函数或是增强现有函数的功能，只要原有函数的参数和返回值等属性不变，那么，所有使用该DLL的原有应用程序都可以在升级后的DLL的支持下运行，而不需要重新编译。这就极大的方便了应用程序的升级和售后支持。
	* 动态链接库除了包括函数的执行代码以外，还可以只包括如图标、位图、字符串和对话框之类的资源，因此可以把应用程序所使用的资源独立出来做成DLL。对于一些常用的资源，把它们做到DLL中后，就可为多个应用程序所共享。
	* 动态链接库便于建立多语言的应用程序。开发者可以将支持多语言的函数放到DLL中，用户可以根据自己所需要的语言选择运行适当的DLL，以获取正确的本地信息。

### DLL文件的存放位置
	程序所需的DLL文件必须位于下面4个目录之一中：
	* 当前目录；
	* Windows的系统目录，如Windows\system；
	* Windows所在的目录，如WINNT；
	* 环境变量PATH中所指定的目录。
	程序在运行时，系统将按上面的顺序查找程序所使用的动态链接库。
	
### 动态链接库的分类
	Visual C++6.0支持多种DLL，包括以下几种。
	* 非MFC DLL
		一般来说，非MFC DLL（non-MFC DLL）的内部不使用MFC，非MFC DLL的导出函数都使用标准的C接口（Standard Interface），因此无论应用程序是否使用了MFC，都可以调用非MFC DLL。
	* MFC常规DLL（MFC Regular DLL）
		MFC常规DLL实际上包含有两方面的含义。一方面它是“MFC的”，这意味着可以在这种DLL的内部使用MFC，另一方面它是“常规的”，这意味着它不同于MFC扩展DLL，在MFC常规DLL的内部虽然可以使用MFC，但是它与应用程序的接口不能是MFC，而是C函数或者C++类。因此MFC的常规DLL可以被非MFC或MFC编写的应用程序所调用。
	* MFC扩展DLL（MFC Extension DLL）
		MFC扩展DLL一般用来提供派生于MFC的可重用的类，以扩展已有的MFC类库的功能。MFC扩展DLL使用MFC的动态链接版本。只有使用MFC生成的可执行程序（无论是EXE还是DLL）才能访问MFC扩展DLL。
	
	选择哪一种DLL的类型可以从以下几个方面来考虑：
	    相比之下，对使用MFC的DLL而言，非MFC DLL显得更为短小精悍。因此，如果DLL不需要使用MFC，那么使用非MFC DLL是一个很好的选择，它将显著地节省磁盘和内存空间。同时，无论应用程序是否使用了MFC，都可以调用非MFC DLL中所导出的函数。
		如果需要创建使用了MFC的DLL，并希望MFC和非MFC应用程序都能使用所创建的DLL，那么可以选择MFC常规DLL。动态链接到MFC常规DLL比较短小，因此可以节省磁盘和内存。
		如果希望在DLL中实现从MFC派生的可重用的类，或者是希望在应用程序和DLL之间传递MFC的派生对象时，必须选择MFC扩展DLL。

